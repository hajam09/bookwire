{% extends "account_base.html" %}
{% load staticfiles %}
{% block content %}
<style type="text/css">
body {
    /*background: #545963;*/
    /*color: white;*/
    margin-top: 20px;
}

.comment-wrapper .panel-body {
    max-height: 650px;
    overflow: auto;
}

.comment-wrapper .media-list .media img {
    width: 64px;
    height: 64px;
    border: 2px solid #e5e7e8;
}

.comment-wrapper .media-list .media {
    border-bottom: 1px dashed #efefef;
    margin-bottom: 25px;
}

.filled-star {
    color: green;
    font-size: 20px;
}

.empty-star{
    color: black;
    font-size: 20px;
}
</style>
<div class="container">
    <div class="row">
        <div class="col-sm-2 hidden-xs">
            <img style="width: 150%;" src="{{book.thumbnail}}" class="img-fluid" alt="">
        </div>
        <div class="col-sm-10" style="padding-left: 90px;">
            <h1>{{book.title}}</h1>
            <br>
            <a href="#">({{book.ratings_count}}) Votes</a>
            <div class="p-4">
                <p class="lead font-weight-bold">Description</p>
                <p>{{book.description}}</p>
            </div>
            <br>
            <div class="row">
                <div class="col-xs-6 col-sm-3">
                    {% if in_favourite_Book %}
                    <button type="button" class="btn btn-danger btn-sm" id="favourites" status="True"><i class="fa fa-star"></i> Remove from my favourites list</button>
                    {% else %}
                    <button type="button" class="btn btn-info btn-sm" id="favourites" status="False"><i class="fa fa-star"></i> Add to my favourite list</button>
                    {% endif %}
                </div>
                <div class="col-xs-6 col-sm-3">
                    {% if in_have_read_Book %}
                    <button type="button" class="btn btn-danger btn-sm" id="have-read" status="True"><i class="fa fa-book"></i> Remove from my have read list</button>
                    {% else %}
                    <button type="button" class="btn btn-info btn-sm" id="have-read" status="False"><i class="fa fa-book"></i> Add to my have read list</button>
                    {% endif %}
                </div>
                <div class="col-xs-6 col-sm-3">
                    {% if in_to_read_Book %}
                    <button type="button" class="btn btn-danger btn-sm" id="to-read" status="True"><i class="glyphicon glyphicon-book"></i> Remove from my to read list</button>
                    {% else %}
                    <button type="button" class="btn btn-info btn-sm" id="to-read" status="False"><i class="glyphicon glyphicon-book"></i> Add to my to read list</button>
                    {% endif %}
                </div>
                <div class="col-xs-6 col-sm-3">
                    {% if in_reading_Book %}
                    <button type="button" class="btn btn-danger btn-sm" id="reading-now" status="True"><i class='fas fa-book-open'></i> Remove from my reading now list</button>
                    {% else %}
                    <button type="button" class="btn btn-info btn-sm" id="reading-now" status="False"><i class='fas fa-book-open'></i> Add to reading now list</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col-md-12">
            <div class="tabbable-panel">
                <div class="tabbable-line">
                    <ul class="nav nav-tabs ">
                        <li class="active">
                            <a href="#tab_default_1" data-toggle="tab">Description</a>
                        </li>
                        <li>
                            <a href="#tab_default_2" data-toggle="tab">Book Info</a>
                        </li>
                        <li>
                            <a href="#tab_default_3" data-toggle="tab">Reviews</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab_default_1">
                            <br>
                            <p>{{book.description}}</p>
                        </div>
                        <div class="tab-pane" id="tab_default_2">
                            <br>
                            <div class="row">
                                <div class="col-xs-6">
                                    <dl class="dl-horizontal">
                                        <dt>Authors</dt>
                                        <dd>{{book.authors}}</dd>
                                        <br>
                                        <dt>Publisher</dt>
                                        <dd>{{book.publisher}}</dd>
                                        <br>
                                        <dt>ISBN 10</dt>
                                        <dd>{{book.isbn_10}}</dd>
                                    </dl>
                                </div>
                                <div class="col-xs-6">
                                    <dl class="dl-horizontal">
                                        <dt>Published Date</dt>
                                        <dd>{{book.published_date}}</dd>
                                        <br>
                                        <dt>Genre</dt>
                                        <dd>{{book.genre}}</dd>
                                        <br>
                                        <dt>ISBN 13</dt>
                                        <dd>{{book.isbn_13}}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab_default_3">
                            <div class="">
                                <div class="comment-wrapper">
                                    <div class="panel panel-info">
                                        <div class="panel-heading">
                                            Comment Panel
                                        </div>
                                        <div class="panel-body">
                                            <textarea class="form-control" placeholder="write a comment..." rows="3"></textarea><br>
                                            <button class="btn btn-success btn-circle pull-right" type="submit" id="submitComment"><span class="glyphicon glyphicon-send"></span> Submit Comment</button>
                                            <div class="clearfix"></div>
                                            <hr>
                                            <div id="user-reviews">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><br><br>
<script type="text/javascript">
$('#favourites').click(function() {
    $.ajax({
        type: "PUT",
        data: {
            functionality: 'favourites',
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(response) {
            if (response.status_code == 403) {
                alert(response.message);
                return;
            } else if (response.status_code == 204) {
                var button = $("#favourites")
                if (button.attr("status") == "False") {
                    button.attr("status", "True")
                    button.attr("class", "btn btn-danger btn-sm")
                    button.html(' <i class="fa fa-star"></i> Remove from my favourites list');
                } else {
                    button.attr("status", "False")
                    button.attr("class", "btn btn-info btn-sm")
                    button.html('<i class="fa fa-star"></i> Add to my favourites list');
                }
            }
        }
    });
});

$('#have-read').click(function() {
    $.ajax({
        type: "PUT",
        data: {
            functionality: 'have-read',
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(response) {
            if (response.status_code == 403) {
                alert(response.message);
                return;
            } else if (response.status_code == 204) {
                var button = $("#have-read")
                if (button.attr("status") == "False") {
                    button.attr("status", "True")
                    button.attr("class", "btn btn-danger btn-sm")
                    button.html('<i class="fa fa-book"></i> Remove from my have read list');
                } else {
                    button.attr("status", "False")
                    button.attr("class", "btn btn-info btn-sm")
                    button.html('<i class="fa fa-book"></i> Add to my have read list');
                }
            }
        }
    });
});

$('#to-read').click(function() {
    $.ajax({
        type: "PUT",
        data: {
            functionality: 'to-read',
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(response) {
            if (response.status_code == 403) {
                alert(response.message);
                return;
            } else if (response.status_code == 204) {
                var button = $("#to-read")
                if (button.attr("status") == "False") {
                    button.attr("status", "True")
                    button.attr("class", "btn btn-danger btn-sm")
                    button.html('<i class="glyphicon glyphicon-book"></i> Remove from my to read list');
                } else {
                    button.attr("status", "False")
                    button.attr("class", "btn btn-info btn-sm")
                    button.html('<i class="glyphicon glyphicon-book"></i> Add to my to read list');
                }
            }
        }
    });
});

$('#reading-now').click(function() {
    $.ajax({
        type: "PUT",
        data: {
            functionality: 'reading-now',
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(response) {
            if (response.status_code == 403) {
                alert(response.message);
                return;
            } else if (response.status_code == 204) {
                var button = $("#reading-now")
                if (button.attr("status") == "False") {
                    button.attr("status", "True")
                    button.attr("class", "btn btn-danger btn-sm")
                    button.html('<i class="fas fa-book-open"></i> Remove from my reading now list');
                } else {
                    button.attr("status", "False")
                    button.attr("class", "btn btn-info btn-sm")
                    button.html('<i class="fas fa-book-open"></i> Add to my reading now list');
                }
            }
        }
    });
});


{% if reviews %}
    $("#user-reviews").append('<ul class="media-list">');
    {% for review in reviews %}
        var stars = "";
        for (var i = 0; i < {{review.rating_value}}; i++) {
            stars += '<i class="fa fa-star filled-star">&nbsp;</i>';
        }
        for (var j = i; i < 5; i++) {
            stars += '<i class="fa fa-star empty-star">&nbsp;</i>';
        }
        $(".media-list").append(
            '<li class="media">' + 
                '<a href="#" class="pull-left">' +
                    '<img src="https://bootdey.com/img/Content/user_1.jpg" alt="" class="img-circle">' +
                '</a>' +
                '<div class="media-body">' +
                    '<span class="text-muted pull-right">' +
                        '<small class="text-muted">{{review.created_at}}</small>' +
                    '</span>' +
                    '<strong class="text-success">{{review.user.get_full_name}}</strong>' +
                    '<p id="review_id_{{review.id}}">{{review.description}}</p>' +
                    stars + 
                '</div>' +
            '</li>');
    {% endfor %}
    $("#user-reviews").append('</ul>');
{% else %}
    $("#user-reviews").append("<p>No reviews has been made for this item!</p>");
{% endif %}
</script>
{% endblock %}